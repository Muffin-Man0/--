<!DOCTYPE html>
<html lang="en" style="overflow: hidden; background-color: white;">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Mosaddek">
    <meta name="keyword" content="FlatLab, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <link rel="shortcut icon" href="img/favicon.png">




    <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
    <!--[if lt IE 9]>
        <script src="js3/html5shiv.js"></script>
        <script src="js3/respond.min.js"></script>
      <title>Tree</title>

      <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/bootstrap-reset.css" rel="stylesheet">
    <!--external css-->
    <link href="/plugin/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="/plugin/fuelux/css/tree-style.css" />
    <!--right slidebar-->
    <link href="/static/css/slidebars.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="/static/css/style.css" rel="stylesheet">
    <link href="/static/css/style-responsive.css" rel="stylesheet" />
    <link rel="stylesheet" href="/plugin/data-tables/DT_bootstrap.css" />
    <!-- Custom styles for this template -->
    <link href="/static/css/style.css" rel="stylesheet">
    <link href="/static/css/style-responsive.css" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="/plugin/bootstrap-datetimepicker/css/datetimepicker.css" />
    <link href="/static/css/bootstrap-select.min.css" rel="stylesheet" />
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
    <!--[if lt IE 9]>
      <script src="js3/html5shiv.js"></script>
      <script src="js3/respond.min.js"></script>

    <![endif]-->

</head>

<body>






    <section id="container" class="" style="background-color: #fff; padding: 20px;">
        <!--header start-->

        <!--header end-->
        <!--sidebar start-->

        <!--sidebar end-->
        <!--main content start-->
        <section id="main-content">
            <section class="wrapper" style="margin-top: 0px;">

                <!-- BEGIN PAGE CONTENT-->
                <div class="row">



                    <div class="col-sm-6">
                        <div class="cmxform form-horizontal tasi-form" id="commentForm">
                            <div class="form-group ">
                                <label for="cemail" class="control-label col-sm-4">车牌号</label>
                                <div class="col-sm-8">
                                    <input class="form-control " id="plate" disabled="disabled" required="">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="cname" class="control-label col-sm-4">所属车组</label>
                                <div class="col-sm-8">
                                    <input class="form-control " id="groupName" disabled="disabled" required="">
                                </div>
                            </div>
                            <div class="form-group ">
                                <label for="cname" class="control-label col-sm-4">报警时间</label>
                                <div class="col-sm-8">
                                    <input class="form-control " style="font-size: 14px;" disabled="disabled" id="alarmTime" required="">
                                </div>
                            </div>
                            <div class="form-group ">
                                <label for="curl" class="control-label col-sm-4">报警地址</label>
                                <div class="col-sm-8">
                                    <input class="form-control " id="latlng" disabled="disabled">
                                </div>
                            </div>
                            <div class="form-group ">
                                <label for="ccomment" class="control-label col-sm-4">报警类型</label>
                                <div class="col-sm-8">
                                    <input class="form-control " id="type" disabled="disabled" required="">
                                </div>
                            </div>


                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="cmxform form-horizontal tasi-form" id="Form1">

                            <div class="form-group ">
                                <label for="ccomment" class="control-label col-sm-4">问题类型</label>
                                <div class="col-sm-8">
                                    <div class="radios">
                                        <label class="label_radio r_on" for="radio-01" style="float: left; margin-right: 10px;">
                                            <input name="sample-radio" class="rd" id="radio-01" checked="checked" value="1" type="radio" aria-checked="true">
                                            测试
                                        </label>
                                        <label class="label_radio r_off" for="radio-02" style="float: left; margin-right: 10px;">
                                            <input name="sample-radio" class="rd" id="radio-02" value="2" type="radio">
                                            误报
                                        </label>
                                        <label class="label_radio r_off" for="radio-03" style="float: left; margin-right: 10px;">
                                            <input name="sample-radio" class="rd" id="radio-03" value="3" type="radio">
                                            安装事故
                                        </label>
                                        <label class="label_radio r_off" for="radio-04" style="float: left; margin-right: 10px; margin-left: 0px;">
                                            <input name="sample-radio" class="rd" id="radio-04" value="4" type="radio">
                                            其他
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group ">
                                <label for="ccomment" class="control-label col-sm-4">备注</label>
                                <div class="col-sm-8">
                                    <textarea class="form-control " id="remark" name="comment" required="" style="margin: 0px -2.67188px 0px 0px; height: 150px;"></textarea>
                                </div>
                            </div>
                            <div class="form-group" style="float: right;">
                                <div class="col-lg-offset-2 col-lg-8">
                                    <button class="btn btn-danger" id="save" style="height: 28px; line-height: 28px; margin: 0 6px; padding: 0 15px; border: 1px solid #dedede; background-color: #f1f1f1; color: #333; border-radius: 2px; font-weight: 400; cursor: pointer; text-decoration: none; border-color: #4898d5; background-color: #2e8ded; color: #fff;">保存</button>
                                    <button class="btn btn-white" id="cancel" style="height: 28px; line-height: 28px; margin: 0 6px; padding: 0 15px; border: 1px solid #dedede; background-color: #f1f1f1; color: #333; border-radius: 2px; font-weight: 400; cursor: pointer; text-decoration: none;">取消</button>
                                </div>
                            </div>
                        </div>
                    </div>





                </div>


                <!-- END PAGE CONTENT-->
            </section>
        </section>
        <!--main content end-->












    </section>

    <!-- js placed at the end of the document so the pages load faster -->
    <script src="/static/js/jquery.js?v=1.1"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.scrollTo.min.js"></script>
    <script src="/static/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script src="js/respond.min.js"></script>
    <script type="text/javascript" language="javascript" src="assets/advanced-datatable/media/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="assets/data-tables/DT_bootstrap.js"></script>
    <!--dynamic table initialization -->
    <script src="js/dynamic_table_init.js"></script>


    <!--right slidebar-->
    <script src="js/slidebars.min.js"></script>


    <!--common script for all pages-->





    <script>
        var params;
        var btn;
        var vehicleId, groupId, type, result = 1, remark, alarmId;
        jQuery(document).ready(function () {
            alarmId = getUrlParam("alarmId");
            var alarmInfo = parent.alarmFrame.$("#alarmTb").bootstrapTable('getRowByUniqueId', alarmId);
            vehicleId = alarmInfo.vehId;
            groupId = alarmInfo.groupId;
            type = alarmInfo.alarmType;
            alarmId = alarmInfo.alarmId;

            $("#plate").val($(alarmInfo.plate).text());
            $("#groupName").val(alarmInfo.groupName);
            $("#alarmTime").val(alarmInfo.time);
            //$("#latlng").val(alarmInfo.x + ',' + alarmInfo.y);
            GetGeo({ "lat": alarmInfo.y, "lon": alarmInfo.x, "tag": "1" });
            $("#type").val(alarmInfo.alarmType);

            //params = getQueryString();
            //for (var i = 0; i < params.length; i++) {
            //    $("#" + params[i].name).val(params[i].value);
            //    switch (params[i].name) {
            //        case "vehId":
            //            vehicleId = params[i].value;
            //            break;
            //        case "groupId":
            //            groupId = params[i].value;
            //            break;
            //        case "type":
            //            type = params[i].value;
            //            break;
            //        case "alarmId":
            //            alarmId = params[i].value;
            //            break;
            //        default:
            //            break;
            //    }
            //}

            $(".rd").click(function (e) {
                result = e.currentTarget.value;
            });

            $('#cancel').click(function () {
                parent.closeWindow();
            })

            $("#save").click(function () {
                btn = $(this).button('loading');
                // business logic...

                //long	alarmId	报警ID
                //long	vehicleId	车辆ID
                //int 	groupId	车组ID
                //String	type	报警类型
                //int	result	判定结果(0:不处理  1:测试  2:误报  3:安装事故  4:其他)
                //String	remark	备注信息

                //alarmId=' + alarmId + '&vehicleId=' + vehicleId + "&groupId=" + groupId + "&type=" + type + "&result=" + result + "&remark=" + remark
                remark = $('#remark').val();
                var list = [];
                list.push({ A: alarmId, V: parseInt(vehicleId), G: parseInt(groupId), T: type });
                var info = { obj: list, J: result, R: $('#remark').val() }
                var url = ajax('http/Monitor/alarmProcess.json?');

                myAjax({
                    type: 'POST',
                    url: url,
                    dataType: 'json',                           //指定服务器返回的数据类型
                    timeout: 10000,                              //请求超时时间
                    cache: false,                               //是否缓存上一次的请求数据
                    async: true,                                //是否异步
                    data: { json: JSON.stringify(info) },
                    beforeSend: function () {
                        //alert(JSON.stringify(info));
                    },
                    success: function (data) {
                        if (data.flag == 1) {
                            parent.showError("报警处理成功!");
                            parent.alarmFrame.$("#alarmTb").bootstrapTable('removeByUniqueId', alarmId);
                            parent.alarmFrame.addCancelAllBtn();
                            //$(".close").click();
                            $("#cancel").click();
                        } else { parent.showError("报警处理失败:" + data.msg); }
                        btn.button('reset');
                    }, error: function (data) {
                        parent.showError("报警处理失败", data.msg);
                        btn.button('reset');
                    }
                });
            });


        });

        //分批获取地理位置
        function GetGeo(lnglatXY) {
            var g = GPS.delta(lnglatXY.lat, lnglatXY.lon);
            lnglatXY.lat = g.lat;
            lnglatXY.lon = g.lon;
            var info = { param: JSON.stringify({ posList: [lnglatXY] }) };
            $.getJSON("http://120.76.69.92:9000/geo/GetGeo.json?jsoncallback=?", info, function (result) {
                if (result.flag == 1) {
                    var obj = result.obj[0];
                    var str = "";
                    $.each(obj.regeocode.roads, function (index) {
                        str += this.direction + "方向距离" + this.name + "约" + parseInt(this.distance) + "米 ";
                    })
                    if (str != "") {
                        str = "(" + str.trim(' ') + ")";
                    }
                    $("#latlng").val(obj.regeocode.formatted_address + str);
                }
            })
        }
    </script>

</body>
</html>
